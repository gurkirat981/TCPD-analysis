---
title: "IAS distribution"
author: "Gurkirat"
date: "06/12/2021"
output: html_document
---

```{r setup, include=FALSE}
library(haven)
library(readr)
library (dplyr)
library(cowplot)
library(tidyverse)
library(ggplot2)
library(MASS)
library(ggrepel)
library(RColorBrewer)
library(stargazer)
library(DeclareDesign)
library(texreg)
library(car)
library(lubridate)
library(scales)
library(cowplot)
library(writexl)
library(janitor)
library(gridExtra)
library(grid)
library(ggpubr)
library(kableExtra)
library(data.table)
library(foreign)
```

```{r, include=FALSE}
ias_profile <- read_csv("ias-profile.csv")
ias_experience <- read_csv("ias-experience.csv")
```

```{r}
Dataverse_merged_dta <- read_stata("BhavnaniLeeAJPSRep1")
#Betrand_scores_dta <- read_stata ("scores.dta")
#Betrand_direct_dta <- read_stata ("direct.dta")
#Betrand_descriptive_dta <- read_stata ("descriptive.dta")
#Betrand_postings_dta <- read_stata ("postings.dta")
#Betrand_officers_dta <- read_stata ("officers.dta")
```
```{r}
newtheme <- theme_bw() +
  theme(panel.border = element_rect(color = "darkgrey", size = 2), 
        panel.grid.major = element_blank(), legend.position = "bottom")
```


```{r}
#Wrangling ias_profile and ias_experience

#Levels & Last_Level
ias_profile <- ias_profile %>% 
mutate (Last_Positions = ifelse (Last_Level == "Above Secretary Level", "Above Secretary Level", 
ifelse(Last_Level == "Additional Secretary", "Additional Secretary", 
ifelse(Last_Level == "Additional Secretary Equivalent", "Additional Secretary", 
ifelse(Last_Level == "Apex Scale", "Secretary",
ifelse(Last_Level == "Cabinet Secretary", "Cabinet Secretary",
ifelse(Last_Level == "Deputy Secretary", "Deputy Secretary",
ifelse(Last_Level == "Deputy Secretary Equivalent", "Deputy Secretary",
ifelse(Last_Level == "Director", "Director",
ifelse(Last_Level == "Director Equivalent", "Director",
ifelse(Last_Level == "Election Commissioner", "Above Secretary Level",
ifelse(Last_Level == "Higher Administrative Grade", "Additional Secretary",
ifelse(Last_Level == "Joint Secretary", "Joint Secretary",
ifelse(Last_Level == "Joint Secretary Equivalent", "Joint Secretary",
ifelse(Last_Level == "Junior Scale", "Junior Scale",
ifelse(Last_Level == "Secretary", "Secretary",
ifelse(Last_Level == "Secretary Equivalent", "Secretary",
ifelse(Last_Level == "Secretary to the Government", "Secretary",
ifelse(Last_Level == "Secretary to the Government, Department of Forest", "Secretary",
ifelse(Last_Level == "Senior Administrative Grade", "Joint Secretary",
ifelse(Last_Level == "Under Secretary", "Under Secretary",
ifelse(Last_Level == "Under Secretary Equivalent", "Under Secretary", NA))))))))))))))))))))))

ias_experience <- ias_experience %>% 
mutate (Positions = ifelse (Level == "Above Secretary Level", "Above Secretary Level", 
ifelse(Level == "Additional Secretary", "Additional Secretary", 
ifelse(Level == "Additional Secretary Equivalent", "Additional Secretary", 
ifelse(Level == "Apex Scale", "Secretary",
ifelse(Level == "Cabinet Secretary", "Cabinet Secretary",
ifelse(Level == "Deputy Secretary", "Deputy Secretary",
ifelse(Level == "Deputy Secretary Equivalent", "Deputy Secretary",
ifelse(Level == "Director", "Director",
ifelse(Level == "Director Equivalent", "Director",
ifelse(Level == "Election Commissioner", "Above Secretary Level",
ifelse(Level == "Higher Administrative Grade", "Additional Secretary",
ifelse(Level == "Joint Secretary", "Joint Secretary",
ifelse(Level == "Joint Secretary Equivalent", "Joint Secretary",
ifelse(Level == "Junior Scale", "Junior Scale",
ifelse(Level == "Secretary", "Secretary",
ifelse(Level == "Secretary Equivalent", "Secretary",
ifelse(Level == "Senior Administrative Grade", "Joint Secretary",
ifelse(Level == "Under Secretary", "Under Secretary",
ifelse(Level == "Under Secretary Equivalent", "Under Secretary", NA))))))))))))))))))))


#Last_Category_of_Experience & Category_of_Experience
ias_profile <- ias_profile %>% 
mutate (Last_Departments = ifelse (Last_Category_of_Experience == "Agriculture & Cooperation", "Agriculture & Cooperation", 
ifelse(Last_Category_of_Experience == "Chemicals & Fertilizers", "Yet to be decided", 
ifelse(Last_Category_of_Experience == "Commerce", "Yet to be decided", 
ifelse(Last_Category_of_Experience == "Communications & Information Technology", "Communications & Information Technology",
ifelse(Last_Category_of_Experience == "Consumer Affairs, Food & PD", "Consumer Affairs, Food & PD",
ifelse(Last_Category_of_Experience == "Corporate Management (New)", "Corporate Management",
ifelse(Last_Category_of_Experience == "Culture", "Culture",
ifelse(Last_Category_of_Experience == "Defence", "Defence",
ifelse(Last_Category_of_Experience == "Development of NER", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Energy", "Energy",
ifelse(Last_Category_of_Experience == "Environment & Forests", "Environment & Forests",
ifelse(Last_Category_of_Experience == "External Affairs", "External Affairs",
ifelse(Last_Category_of_Experience == "Finance", "Finance",
ifelse(Last_Category_of_Experience == "Health & Family Welfare", "Health & Family Welfare",
ifelse(Last_Category_of_Experience == "Home", "Home",
ifelse(Last_Category_of_Experience == "Human Resource Dev", "Human Resource Dev",
ifelse(Last_Category_of_Experience == "Industrial production", "Industries",
ifelse(Last_Category_of_Experience == "Industries", "Industries",
ifelse(Last_Category_of_Experience == "Information & Broadcasting", "Information & Broadcasting",
ifelse(Last_Category_of_Experience == "Labour & Employment", "Labour & Employment",
ifelse(Last_Category_of_Experience == "Land Revenue Mgmt & District Admn", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Law and Justice", "Law and Justice",
ifelse(Last_Category_of_Experience == "Local Self Govt", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Mines & Minerals", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Parliamentary Affairs", "Parliamentary Affairs",
ifelse(Last_Category_of_Experience == "Personnel and General Administration", "Personnel and General Administration",
ifelse(Last_Category_of_Experience == "Petroleum & Natural Gas", "Petroleum & Natural Gas",
ifelse(Last_Category_of_Experience == "Planning & Prog Implementation", "Planning & Prog Implementation",
ifelse(Last_Category_of_Experience == "Protocol", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Public Administration", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Public Policy", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Public Policy", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Public Works", "Public Works",
ifelse(Last_Category_of_Experience == "Rural Dev", "Rural Development",
ifelse(Last_Category_of_Experience == "Science & Technology", "Science & Technology",
ifelse(Last_Category_of_Experience == "Service Commn", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Social Justice & Empowerment", "Social Justice & Empowerment",
ifelse(Last_Category_of_Experience == "ST Welfare", "Social Justice & Empowerment",
ifelse(Last_Category_of_Experience == "Staff Officers", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Textiles", "Textiles",
ifelse(Last_Category_of_Experience == "Tourism", "Tourism",
ifelse(Last_Category_of_Experience == "Training", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Transport", "Yet to be decided",
ifelse(Last_Category_of_Experience == "Urban Development", "Urban Development",
ifelse(Last_Category_of_Experience == "Water Resources", "Water Resources",
ifelse(Last_Category_of_Experience == "Women & Child Dev", "Women & Child Dev",
ifelse(Last_Category_of_Experience == "Youth Affairs & Sports", "Youth Affairs & Sports", NA))))))))))))))))))))))))))))))))))))))))))))))))

ias_experience <- ias_experience %>% 
mutate (Departments = ifelse (Category_of_Experience == "Agriculture & Cooperation", "Agriculture & Cooperation", 
ifelse(Category_of_Experience == "Chemicals & Fertilizers", "Yet to be decided", 
ifelse(Category_of_Experience == "Commerce", "Yet to be decided", 
ifelse(Category_of_Experience == "Communications & Information Technology", "Communications & Information Technology",
ifelse(Category_of_Experience == "Consumer Affairs, Food & PD", "Consumer Affairs, Food & PD",
ifelse(Category_of_Experience == "Corporate Management (New)", "Corporate Management",
ifelse(Category_of_Experience == "Culture", "Culture",
ifelse(Category_of_Experience == "Defence", "Defence",
ifelse(Category_of_Experience == "Development of NER", "Yet to be decided",
ifelse(Category_of_Experience == "Energy", "Energy",
ifelse(Category_of_Experience == "Environment & Forests", "Environment & Forests",
ifelse(Category_of_Experience == "External Affairs", "External Affairs",
ifelse(Category_of_Experience == "Finance", "Finance",
ifelse(Category_of_Experience == "Health & Family Welfare", "Health & Family Welfare",
ifelse(Category_of_Experience == "Home", "Home",
ifelse(Category_of_Experience == "Human Resource Dev", "Human Resource Dev",
ifelse(Category_of_Experience == "Industrial production", "Industries",
ifelse(Category_of_Experience == "Industries", "Industries",
ifelse(Category_of_Experience == "Information & Broadcasting", "Information & Broadcasting",
ifelse(Category_of_Experience == "Labour & Employment", "Labour & Employment",
ifelse(Category_of_Experience == "Land Revenue Mgmt & District Admn", "Yet to be decided",
ifelse(Category_of_Experience == "Law and Justice", "Law and Justice",
ifelse(Category_of_Experience == "Local Self Govt", "Yet to be decided",
ifelse(Category_of_Experience == "Mines & Minerals", "Yet to be decided",
ifelse(Category_of_Experience == "Parliamentary Affairs", "Parliamentary Affairs",
ifelse(Category_of_Experience == "Personnel and General Administration", "Personnel and General Administration",
ifelse(Category_of_Experience == "Petroleum & Natural Gas", "Petroleum & Natural Gas",
ifelse(Category_of_Experience == "Planning & Prog Implementation", "Planning & Prog Implementation",
ifelse(Category_of_Experience == "Protocol", "Yet to be decided",
ifelse(Category_of_Experience == "Public Administration", "Yet to be decided",
ifelse(Category_of_Experience == "Public Policy", "Yet to be decided",
ifelse(Category_of_Experience == "Public Policy", "Yet to be decided",
ifelse(Category_of_Experience == "Public Works", "Public Works",
ifelse(Category_of_Experience == "Rural Dev", "Rural Development",
ifelse(Category_of_Experience == "Science & Technology", "Science & Technology",
ifelse(Category_of_Experience == "Service Commn", "Yet to be decided",
ifelse(Category_of_Experience == "Social Justice & Empowerment", "Social Justice & Empowerment",
ifelse(Category_of_Experience == "ST Welfare", "Social Justice & Empowerment",
ifelse(Category_of_Experience == "Staff Officers", "Yet to be decided",
ifelse(Category_of_Experience == "Textiles", "Textiles",
ifelse(Category_of_Experience == "Tourism", "Tourism",
ifelse(Category_of_Experience == "Training", "Yet to be decided",
ifelse(Category_of_Experience == "Transport", "Yet to be decided",
ifelse(Category_of_Experience == "Urban Development", "Urban Development",
ifelse(Category_of_Experience == "Water Resources", "Water Resources",
ifelse(Category_of_Experience == "Women & Child Dev", "Women & Child Dev",
ifelse(Category_of_Experience == "Youth Affairs & Sports", "Youth Affairs & Sports", NA))))))))))))))))))))))))))))))))))))))))))))))))

#nature of department
ias_profile <- ias_profile %>% 
mutate (Nature_of_Department = ifelse (Last_Category_of_Experience == "Agriculture & Cooperation", "Others", 
ifelse(Last_Category_of_Experience == "Chemicals & Fertilizers", "Others", 
ifelse(Last_Category_of_Experience == "Commerce", "Hard", 
ifelse(Last_Category_of_Experience == "Communications & Information Technology", "Others",
ifelse(Last_Category_of_Experience == "Consumer Affairs, Food & PD", "Others",
ifelse(Last_Category_of_Experience == "Corporate Management (New)", "Others",
ifelse(Last_Category_of_Experience == "Culture", "Soft",
ifelse(Last_Category_of_Experience == "Defence", "Hard",
ifelse(Last_Category_of_Experience == "Development of NER", "Soft",
ifelse(Last_Category_of_Experience == "Energy", "Hard",
ifelse(Last_Category_of_Experience == "Environment & Forests", "Others",
ifelse(Last_Category_of_Experience == "External Affairs", "Hard",
ifelse(Last_Category_of_Experience == "Finance", "Hard",
ifelse(Last_Category_of_Experience == "Health & Family Welfare", "Soft",
ifelse(Last_Category_of_Experience == "Home", "Hard",
ifelse(Last_Category_of_Experience == "Human Resource Dev", "Soft",
ifelse(Last_Category_of_Experience == "Industrial production", "Hard",
ifelse(Last_Category_of_Experience == "Industries", "Hard",
ifelse(Last_Category_of_Experience == "Information & Broadcasting", "Others",
ifelse(Last_Category_of_Experience == "Labour & Employment", "Others",
ifelse(Last_Category_of_Experience == "Land Revenue Mgmt & District Admn", NA,
ifelse(Last_Category_of_Experience == "Law and Justice", "Others",
ifelse(Last_Category_of_Experience == "Local Self Govt", "Soft",
ifelse(Last_Category_of_Experience == "Mines & Minerals", NA,
ifelse(Last_Category_of_Experience == "Parliamentary Affairs", "Others",
ifelse(Last_Category_of_Experience == "Personnel and General Administration", "Others",
ifelse(Last_Category_of_Experience == "Petroleum & Natural Gas", "Hard",
ifelse(Last_Category_of_Experience == "Planning & Prog Implementation", "Others",
ifelse(Last_Category_of_Experience == "Protocol", "Others",
ifelse(Last_Category_of_Experience == "Public Administration", "Others",
ifelse(Last_Category_of_Experience == "Public Policy", "Others",
ifelse(Last_Category_of_Experience == "Public Works", "Others",
ifelse(Last_Category_of_Experience == "Rural Dev", "Soft",
ifelse(Last_Category_of_Experience == "Science & Technology", "Others",
ifelse(Last_Category_of_Experience == "Service Commn", "Others",
ifelse(Last_Category_of_Experience == "Social Justice & Empowerment", "Soft",
ifelse(Last_Category_of_Experience == "ST Welfare", "Soft",
ifelse(Last_Category_of_Experience == "Staff Officers", "Others",
ifelse(Last_Category_of_Experience == "Textiles", "Soft",
ifelse(Last_Category_of_Experience == "Tourism", "Soft",
ifelse(Last_Category_of_Experience == "Training", "Others",
ifelse(Last_Category_of_Experience == "Transport", "Others",
ifelse(Last_Category_of_Experience == "Urban Development", "Others",
ifelse(Last_Category_of_Experience == "Water Resources", "Others",
ifelse(Last_Category_of_Experience == "Women & Child Dev", "Soft",
ifelse(Last_Category_of_Experience == "Youth Affairs & Sports", "Soft", NA)))))))))))))))))))))))))))))))))))))))))))))))

#Source of Recruitment
ias_profile <- ias_profile %>% 
mutate (Assigned_SOR = ifelse (Source_of_Recruitment == "By Promotion from State Civil Service", "By Promotion from State Civil Service", 
ifelse(Source_of_Recruitment == "Direct Recruitment", "Direct Recruitment", 
ifelse(Source_of_Recruitment == "SCS", "By Promotion from State Civil Service", 
ifelse(Source_of_Recruitment == "RR", "Direct Recruitment",
ifelse(Source_of_Recruitment == "By Selection", "By Promotion from State Civil Service", NA)))))) 

#Assigning Reference Values to last positions (ias_profile)
ias_profile <- ias_profile %>% 
mutate(ReferenceValues = ifelse (Last_Positions == "Junior Scale", 8, 
ifelse(Last_Positions == "Director", 7, 
ifelse(Last_Positions == "Deputy Secretary", 6, 
ifelse(Last_Positions == "Under Secretary", 5,
ifelse(Last_Positions == "Joint Secretary", 4,
ifelse(Last_Positions == "Additional Secretary", 3,
ifelse(Last_Positions == "Secretary", 2,
ifelse(Last_Positions == "Cabinet Secretary", 1,
ifelse(Last_Positions == "Above Secretary Level", 0, NA))))))))))

#Cleaning Cadre
ias_profile <- ias_profile %>% 
mutate (Cadre = ifelse(Cadre == "Chhasttisgarh", "Chhattisgarh", Cadre)) %>% 
mutate (Cadre = ifelse(Cadre == "Maharastra", "Maharashtra", Cadre))

#Assigning another variable where Cadre is identical to the Place of Domicile
ias_profile <- ias_profile %>% 
  mutate(Cadre_Domicile=(ifelse(Place_of_Domicile=="Andaman and Nicobar" & Cadre=="A G M U T",1,
                     ifelse(Place_of_Domicile=="Andhra Pradesh" & Cadre=="Andhra Pradesh", 1,        
                     ifelse(Place_of_Domicile=="Arunachal Pradesh" & Cadre=="A G M U T",1,
                     ifelse(Place_of_Domicile=="Assam" & Cadre=="Assam Meghalya",1,
                     ifelse(Place_of_Domicile=="Bihar" & Cadre=="Bihar",1,
                     ifelse(Place_of_Domicile=="Chandigarh" & Cadre=="A G M U T",1,
                     ifelse(Place_of_Domicile=="Chhattisgarh" & Cadre=="Chhattisgarh",1,
                     ifelse(Place_of_Domicile=="Dadra and Nagar Haveli and Daman and Dui" & Cadre=="A G M U T",1,      
                     ifelse(Place_of_Domicile=="Goa" & Cadre=="A G M U T",1,
                     ifelse(Place_of_Domicile=="Gujarat" & Cadre=="Gujarat",1,
                     ifelse(Place_of_Domicile=="Haryana" & Cadre=="Haryana",1,
                     ifelse(Place_of_Domicile=="Himachal Pradesh" & Cadre=="Himachal Pradesh",1,
                     ifelse(Place_of_Domicile=="Jammu & Kashmir" & Cadre=="Jammu & Kashmir",1,
                     ifelse(Place_of_Domicile=="Jharkhand" & Cadre=="Jharkhand",1,
                     ifelse(Place_of_Domicile=="Karnataka" & Cadre=="Karnataka",1,
                     ifelse(Place_of_Domicile=="Kerala" & Cadre=="Kerala",1,
                     ifelse(Place_of_Domicile=="Ladakh" & Cadre=="Jammu and Kashmir",1,
                     ifelse(Place_of_Domicile=="Lakshadweep" & Cadre=="A G M U T",1,       
                     ifelse(Place_of_Domicile=="Madhya Pradesh" & Cadre=="Madhya Pradesh",1,
                     ifelse(Place_of_Domicile=="Maharashtra" & Cadre=="Maharashtra",1,
                     ifelse(Place_of_Domicile=="Manipur" & Cadre=="Manipur",1,
                     ifelse(Place_of_Domicile=="Meghalaya" & Cadre=="Assam Meghalaya",1,
                     ifelse(Place_of_Domicile=="Mizoram" & Cadre=="A G M U T",1,       
                     ifelse(Place_of_Domicile=="Nagaland" & Cadre=="Nagaland",1,
                     ifelse(Place_of_Domicile=="Manipur-Tripura" & Cadre=="Manipur-Tripura",1,
                     ifelse(Place_of_Domicile=="Delhi" & Cadre=="A G M U T",1, 
                     ifelse(Place_of_Domicile=="Odisha" & Cadre=="Odisha",1,
                     ifelse(Place_of_Domicile=="Pondicherry" & Cadre=="A G M U T",1,        
                     ifelse(Place_of_Domicile=="Punjab" & Cadre=="Punjab",1,
                     ifelse(Place_of_Domicile=="Rajasthan" & Cadre=="Rajasthan",1,
                     ifelse(Place_of_Domicile=="Sikkim" & Cadre=="Sikkim",1,
                     ifelse(Place_of_Domicile=="Tamil Nadu" & Cadre=="Tamil Nadu",1,
                     ifelse(Place_of_Domicile=="Telangana" & Cadre=="Telangana",1,
                     ifelse(Place_of_Domicile=="Tripura" & Cadre=="Tripura",1,
                     ifelse(Place_of_Domicile=="Uttar Pradesh" & Cadre=="Uttar Pradesh",1,
                     ifelse(Place_of_Domicile=="Uttarakhand" & Cadre=="Uttarakhand",1,
                     ifelse(Place_of_Domicile=="West Bengal" & Cadre=="West Bengal",1, 0)))))))))))))))))))))))))))))))))))))))

#Collapsing allotment year into decades
ias_profile <- ias_profile %>% 
mutate (Allotment_Decade = ifelse(ias_profile$Allotment_Year > 1950 & ias_profile$Allotment_Year < 1961 , "1950-1960",
ifelse(ias_profile$Allotment_Year > 1960 & ias_profile$Allotment_Year < 1971, "1960-1970",
ifelse(ias_profile$Allotment_Year > 1970 & ias_profile$Allotment_Year < 1981, "1970-1980",
ifelse(ias_profile$Allotment_Year > 1980 & ias_profile$Allotment_Year < 1991, "1980-1990",
ifelse(ias_profile$Allotment_Year > 1990 & ias_profile$Allotment_Year < 2001, "1990-2000",
ifelse(ias_profile$Allotment_Year > 2000 & ias_profile$Allotment_Year < 2011, "2000-2010",
ifelse(ias_profile$Allotment_Year > 2010 & ias_profile$Allotment_Year < 2021, "2010-2020", Allotment_Year))))))))
```

```{r}
#Calculating Tenure for all positions
ias_experience <- ias_experience %>% 
mutate (End_Date = as.Date(ias_experience$End_Date)) %>% 
mutate (Start_Date = as.Date(ias_experience$Start_Date)) %>% 
mutate (Tenure = difftime(End_Date, Start_Date, units = "days")) %>% 
mutate (Tenure = as.numeric(Tenure))

#Calculating Tenure for last positions
ias_profile <- ias_profile %>% 
mutate (Last_End_Date = as.Date(ias_profile$Last_End_Date)) %>% 
mutate (Last_Start_Date = as.Date(ias_profile$Last_Start_Date)) %>% 
mutate (Tenure = difftime(Last_End_Date, Last_Start_Date, units = "days")) %>% 
mutate (Tenure = as.numeric(Tenure))

#Calculating age at the time of allotment
ias_profile <- ias_profile %>% 
mutate (Date_of_Birth = as.Date(Date_of_Birth)) %>% 
mutate (Date_of_Joining = as.Date(Date_of_Joining)) %>% 
mutate (Allotment_age = difftime(Date_of_Joining, Date_of_Birth, units = "weeks")) %>% 
mutate (Allotment_age = round(as.numeric(Allotment_age)/52,1))

#Percentage of DR and SCS by cadre
Cadre_DR <- as.data.frame(table(ias_profile$Cadre[ias_profile$Assigned_SOR == "Direct Recruitment"])) %>% 
rename ("Cadre" = Var1) %>% 
rename ("Direct Recruits (freq)" = Freq) 

Cadre_SCS <- as.data.frame(table(ias_profile$Cadre[ias_profile$Assigned_SOR == "By Promotion from State Civil Service"])) %>% 
rename ("Cadre1" = Var1) %>% 
rename ("Promotees (freq)" = Freq) 

Cadre <- cbind(Cadre_DR, Cadre_SCS) %>% 
dplyr::select(-Cadre1) %>% 
mutate("Total no. of Officers" = rowSums(.[2:3])) %>% 
mutate ("Direct Recruits %"= `Direct Recruits (freq)`/`Total no. of Officers`) %>% 
mutate ("Promotees %"= `Promotees (freq)`/`Total no. of Officers`) %>% 
mutate (`Direct Recruits %`= round(`Direct Recruits %`*100,2)) %>% 
mutate (`Promotees %`= round(`Promotees %`*100,2)) %>% 
arrange (`Cadre`)


Cadre %>%
  kbl(caption = "Distribution of all officers by Cadre and Source of Recruitment")%>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15) %>% 
  footnote(number = c("Derived from the 'TCPD-Bureaucrats of India' Dataset", "Sample: Total no. of officers hired between 1951 and 2020"))

#Distribution of all officers (by Cadre and SOR) where Domicile is identical to Cadre
ias_cadre <- ias_profile %>% 
filter (Cadre_Domicile == 1)

Cadre_DR_ss <- as.data.frame(table(ias_cadre$Cadre[ias_cadre$Assigned_SOR == "Direct Recruitment"])) %>% 
rename ("Cadre" = Var1) %>% 
rename ("Direct Recruits (freq)" = Freq) 

Cadre_SCS_ss <- as.data.frame(table(ias_cadre$Cadre[ias_cadre$Assigned_SOR == "By Promotion from State Civil Service"])) %>% 
rename ("Cadre1" = Var1) %>% 
rename ("Promotees (freq)" = Freq) %>% 
add_row(`Cadre1` = "Telangana", `Promotees (freq)` = 0) %>% 
arrange (`Cadre1`)

Cadre_ss <- cbind(Cadre_SCS_ss, Cadre_DR_ss) %>% 
dplyr::select(-Cadre) %>% 
mutate("Total no. of Officers from the same State as their Cadre" = rowSums(.[2:3])) %>% 
mutate ("% Direct Recruits S/C"= `Direct Recruits (freq)`/`Total no. of Officers from the same State as their Cadre`) %>% 
mutate ("% Promotees S/C"= `Promotees (freq)`/`Total no. of Officers from the same State as their Cadre`) %>% 
mutate (`% Direct Recruits S/C`= round(`% Direct Recruits S/C`*100,2)) %>% 
mutate (`% Promotees S/C`= round(`% Promotees S/C`*100,2)) %>% 
arrange (`Cadre1`)

Cadre_combined <- cbind (Cadre, Cadre_ss) %>%
dplyr::select (-Cadre1, -`Total no. of Officers from the same State as their Cadre`, -`Total no. of Officers`, -`Direct Recruits (freq)`, -`Promotees (freq)`)

Cadre_combined %>%
  kbl(caption = "Distribution of all officers where Cadre is identical to domicile")%>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15) %>% 
  footnote(number = c("Derived from the 'TCPD-Bureaucrats of India' Dataset", "Sample: Total no. of officers hired between 1951 and 2020"))
```


```{r}
#Subsetting last positions from ias_profile for all officers
subset1 <- ias_profile %>% 
dplyr::select(Name, Last_Departments, Last_Positions, ReferenceValues, Assigned_SOR, Gender, Assigned_SOR, Nature_of_Department, Allotment_Year, Allotment_age)

subset1_male <- subset1 %>% 
filter (Gender == "Male")

subset1_female <- subset1 %>% 
filter (Gender == "Female")

subset1_DR <- subset1 %>% 
filter (Assigned_SOR == "Direct Recruitment")

subset1_SCS <- subset1 %>% 
filter (Assigned_SOR == "By Promotion from State Civil Service")

#Aggregate 
Last_Positions <- as.data.frame(table(ias_profile$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.009355, 2))  

#Women
LP_women <- as.data.frame(table(subset1_female$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
add_row(`Last Positions`="Cabinet Secretary", `No. of Observations (Frequency)` = 0) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.08928, 2))  

#Men
LP_men <- as.data.frame(table(subset1_male$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01045, 2))  

#DR
LP_DR <- as.data.frame(table(subset1_DR$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.016134, 2))  

#SCS
LP_SCS <- as.data.frame(table(subset1_SCS$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
add_row(`Last Positions`="Above Secretary Level", `No. of Observations (Frequency)` = 0) %>%
add_row(`Last Positions`="Cabinet Secretary", `No. of Observations (Frequency)` = 0) %>%
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.02294, 2))  
```

```{r}
#Subsetting last departments from ias_profile for all officers

#Aggregate 
Last_Departments <- as.data.frame(table(ias_profile$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01175, 2))  

#Women
dept_women <- as.data.frame(table(subset1_female$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.1094, 2))  

#Men
dept_men <- as.data.frame(table(subset1_male$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01316, 2))  

#DR
dept_DR <- as.data.frame(table(subset1_DR$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01991, 2))  

#SCS
dept_SCS <- as.data.frame(table(subset1_SCS$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.0297, 2))  
```

```{r}
#Subsetting last positions from ias_profile only for former officers
ias_former <- ias_profile %>% 
dplyr::filter(Retired == 1)

subset1_former <- ias_former %>% 
dplyr::select(Name, Last_Departments, Last_Positions, ReferenceValues, Assigned_SOR, Gender, Assigned_SOR, Nature_of_Department)

subset1_male_former <- subset1_former %>% 
filter (Gender == "Male")

subset1_female_former <- subset1_former %>% 
filter (Gender == "Female")

subset1_DR_former <- subset1_former %>% 
filter (Assigned_SOR == "Direct Recruitment")

subset1_SCS_former <- subset1_former %>% 
filter (Assigned_SOR == "By Promotion from State Civil Service")

#Aggregate 
Last_Positions_former <- as.data.frame(table(ias_former$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.0127, 2))  

#Women
LP_women_former <- as.data.frame(table(subset1_female_former$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
add_row(`Last Positions`="Cabinet Secretary", `No. of Observations (Frequency)` = 0) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.19305, 2))  

#Men
LP_men_former <- as.data.frame(table(subset1_male_former$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01359, 2))  

#DR
LP_DR_former <- as.data.frame(table(subset1_DR_former$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.02679, 2))  

#SCS
LP_SCS_former <- as.data.frame(table(subset1_SCS_former$Last_Positions)) %>% 
rename ("Last Positions" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
add_row(`Last Positions`="Above Secretary Level", `No. of Observations (Frequency)` = 0) %>%
add_row(`Last Positions`="Cabinet Secretary", `No. of Observations (Frequency)` = 0) %>%
arrange (`Last Positions`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.02494, 2))  
```

```{r}
#Subsetting last departments from ias_profile only for former officers

#Aggregate 
Last_Departments_former <- as.data.frame(table(ias_former$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.01576, 2))  

#Women
dept_women_former <- as.data.frame(table(subset1_female_former$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.23364, 2))  

#Men
dept_men_former <- as.data.frame(table(subset1_male_former$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.0169, 2))  

#DR
dept_DR_former <- as.data.frame(table(subset1_DR_former$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.03131, 2))  

#SCS
dept_SCS_former <- as.data.frame(table(subset1_SCS_former$Nature_of_Department)) %>% 
rename ("Nature of the Department" = Var1) %>% 
rename ("No. of Observations (Frequency)" = Freq) %>% 
arrange (`Nature of the Department`) %>% 
mutate (Percentage = round(`No. of Observations (Frequency)`*0.03299, 2))  
```

I. Aggregate graph: Last Positions (from ias_profile dataset)

```{r, echo = FALSE, fig.height=6,fig.width=8, warning=FALSE}
mean_ASL <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Above Secretary Level"]*0.009355, 2)
mean_AS <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Additional Secretary"]*0.009355, 2)
mean_CS <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Cabinet Secretary"]*0.009355, 2)
mean_DS <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Deputy Secretary"]*0.009355, 2)
mean_DR <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Director"]*0.009355, 2)
mean_JS <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Joint Secretary"]*0.009355, 2)
mean_jsc <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Junior Scale"]*0.009355, 2)
mean_S <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Secretary"]*0.009355, 2)
mean_US <- round(Last_Positions$`No. of Observations (Frequency)`[Last_Positions$`Last Positions` == "Under Secretary"]*0.009355, 2)

lp_full_plot <- c(mean_ASL, mean_AS, mean_CS, mean_DS, mean_DR, mean_JS, mean_jsc, mean_S, mean_US)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_plot_dta <- data.frame(lp_full_plot, last_position_agg_lable) 
lp_plot_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_plot_dta$last_position_agg_lable <- factor(lp_plot_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_full_plot <- ggplot(lp_plot_dta, aes(x=last_position_agg_lable, y=lp_full_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,30)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Aggregate graph: Last Positions (1951-2020)", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_full_plot
```

II. Last Positions: Dis-aggregated by Gender

```{r, echo = FALSE, fig.height=8,fig.width=10, warning=FALSE}
#Women Officers
mean_ASL_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Above Secretary Level"]*0.08928, 2)
mean_AS_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Additional Secretary"]*0.08928, 2)
mean_CS_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Cabinet Secretary"]*0.08928, 2)
mean_DS_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Deputy Secretary"]*0.08928, 2)
mean_DR_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Director"]*0.08928, 2)
mean_JS_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Joint Secretary"]*0.08928, 2)
mean_jsc_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Junior Scale"]*0.08928, 2)
mean_S_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Secretary"]*0.08928, 2)
mean_US_women <- round(LP_women$`No. of Observations (Frequency)`[LP_women$`Last Positions` == "Under Secretary"]*0.08928, 2)

lp_women_full_plot <- c(mean_ASL_women, mean_AS_women, mean_CS_women, mean_DS_women, mean_DR_women, mean_JS_women, mean_jsc_women, mean_S_women, mean_US_women)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 

lp_women_plot_dta <- data.frame(lp_women_full_plot, last_position_agg_lable) 
lp_women_plot_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_women_plot_dta$last_position_agg_lable <- factor(lp_women_plot_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_women_full_plot <- ggplot(lp_women_plot_dta, aes(x=last_position_agg_lable, y=lp_women_full_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_women_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,30)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Women Officers (1951-2020)") +
  newtheme

lp_women_full_plot

#Male Officers
mean_ASL_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Above Secretary Level"]*0.01045, 2)
mean_AS_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Additional Secretary"]*0.01045, 2)
mean_CS_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Cabinet Secretary"]*0.01045, 2)
mean_DS_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Deputy Secretary"]*0.01045, 2)
mean_DR_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Director"]*0.01045, 2)
mean_JS_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Joint Secretary"]*0.01045, 2)
mean_jsc_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Junior Scale"]*0.01045, 2)
mean_S_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Secretary"]*0.01045, 2)
mean_US_men <- round(LP_men$`No. of Observations (Frequency)`[LP_men$`Last Positions` == "Under Secretary"]*0.01045, 2)

lp_men_full_plot <- c(mean_ASL_men, mean_AS_men, mean_CS_men, mean_DS_men, mean_DR_men, mean_JS_men, mean_jsc_men, mean_S_men, mean_US_men)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_men_plot_dta <- data.frame(lp_men_full_plot, last_position_agg_lable) 
lp_men_plot_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_men_plot_dta$last_position_agg_lable <- factor(lp_men_plot_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_men_full_plot <- ggplot(lp_men_plot_dta, aes(x=last_position_agg_lable, y=lp_men_full_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_men_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,30)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Male Officers (1951-2020)", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_men_full_plot

grid.newpage()
grid.draw(rbind(ggplotGrob(lp_women_full_plot), ggplotGrob(lp_men_full_plot), size = "last"))
```

III. Last Positions: Dis-aggregated by Source of Recruitment

```{r, echo = FALSE, fig.height=8,fig.width=10, warning=FALSE}
#Direct Recruits
mean_ASL_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Above Secretary Level"]*0.016134, 2)
mean_AS_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Additional Secretary"]*0.016134, 2)
mean_CS_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Cabinet Secretary"]*0.016134, 2)
mean_DS_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Deputy Secretary"]*0.016134, 2)
mean_DR_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Director"]*0.016134, 2)
mean_JS_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Joint Secretary"]*0.016134, 2)
mean_jsc_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Junior Scale"]*0.016134, 2)
mean_S_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Secretary"]*0.016134, 2)
mean_US_DR <- round(LP_DR$`No. of Observations (Frequency)`[LP_DR$`Last Positions` == "Under Secretary"]*0.016134, 2)

lp_DR_full_plot <- c(mean_ASL_DR, mean_AS_DR, mean_CS_DR, mean_DS_DR, mean_DR_DR, mean_JS_DR, mean_jsc_DR, mean_S_DR, mean_US_DR)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_DR_plot_dta <- data.frame(lp_DR_full_plot, last_position_agg_lable) 
lp_DR_plot_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_DR_plot_dta$last_position_agg_lable <- factor(lp_DR_plot_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_DR_full_plot <- ggplot(lp_DR_plot_dta, aes(x=last_position_agg_lable, y=lp_DR_full_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_DR_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,40)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Officers hired through Direct Recruitment (1951-2020)") +
  newtheme

lp_DR_full_plot

#SCS
mean_ASL_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Above Secretary Level"]*0.02294, 2)
mean_AS_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Additional Secretary"]*0.02294, 2)
mean_CS_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Cabinet Secretary"]*0.02294, 2)
mean_DS_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Deputy Secretary"]*0.02294, 2)
mean_DR_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Director"]*0.02294, 2)
mean_JS_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Joint Secretary"]*0.02294, 2)
mean_jsc_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Junior Scale"]*0.02294, 2)
mean_S_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Secretary"]*0.02294, 2)
mean_US_SCS <- round(LP_SCS$`No. of Observations (Frequency)`[LP_SCS$`Last Positions` == "Under Secretary"]*0.02294, 2)

lp_SCS_full_plot <- c(mean_ASL_SCS, mean_AS_SCS, mean_CS_SCS, mean_DS_SCS, mean_DR_SCS, mean_JS_SCS, mean_jsc_SCS, mean_S_SCS, mean_US_SCS)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_SCS_plot_dta <- data.frame(lp_SCS_full_plot, last_position_agg_lable) 
lp_SCS_plot_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_SCS_plot_dta$last_position_agg_lable <- factor(lp_SCS_plot_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_SCS_full_plot <- ggplot(lp_SCS_plot_dta, aes(x=last_position_agg_lable, y=lp_SCS_full_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_SCS_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,40)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Officers hired through promotion from State Civil Service (1951-2020)", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_SCS_full_plot

grid.newpage()
grid.draw(rbind(ggplotGrob(lp_DR_full_plot), ggplotGrob(lp_SCS_full_plot), size = "last"))
```

I. Aggregate graph: Last Departments (from ias_profile dataset)

```{r, echo = FALSE, fig.height=4,fig.width=6, warning=FALSE}
mean_hard <- round(Last_Departments$`No. of Observations (Frequency)`[Last_Departments$`Nature of the Department` == "Hard"]*0.01175, 2)
mean_soft <- round(Last_Departments$`No. of Observations (Frequency)`[Last_Departments$`Nature of the Department` == "Soft"]*0.01175, 2)
mean_others <- round(Last_Departments$`No. of Observations (Frequency)`[Last_Departments$`Nature of the Department` == "Others"]*0.01175, 2)

last_dept_full_plot <- c(mean_hard, mean_soft, mean_others)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_plot_dta <- data.frame(last_dept_full_plot, last_dept_agg_lable) 
last_dept_plot_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_full_plot <- ggplot(last_dept_plot_dta, aes(x=last_dept_agg_lable, y=last_dept_full_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset", subtitle = "Aggregate graph: Last Departments (1951-2020)") +
  newtheme

last_dept_full_plot
```

II. Last Departments: Dis-aggregated by Gender

```{r, echo = FALSE, fig.height=5,fig.width=8, warning=FALSE}
#Women Officers
mean_hard_women <- round(dept_women$`No. of Observations (Frequency)`[dept_women$`Nature of the Department` == "Hard"]*0.1094, 2)
mean_soft_women <- round(dept_women$`No. of Observations (Frequency)`[dept_women$`Nature of the Department` == "Soft"]*0.1094, 2)
mean_others_women <- round(dept_women$`No. of Observations (Frequency)`[dept_women$`Nature of the Department` == "Others"]*0.1094, 2)

last_dept_women_full_plot <- c(mean_hard_women, mean_soft_women, mean_others_women)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_women_plot_dta <- data.frame(last_dept_women_full_plot, last_dept_agg_lable) 
last_dept_women_plot_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_women_full_plot <- ggplot(last_dept_women_plot_dta, aes(x=last_dept_agg_lable, y=last_dept_women_full_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_women_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", subtitle = "Last Departments: Women Officers (1951-2020)") +
  newtheme

last_dept_women_full_plot

#Male Officers
mean_hard_men <- round(dept_men$`No. of Observations (Frequency)`[dept_men$`Nature of the Department` == "Hard"]*0.01316, 2)
mean_soft_men <- round(dept_men$`No. of Observations (Frequency)`[dept_men$`Nature of the Department` == "Soft"]*0.01316, 2)
mean_others_men <- round(dept_men$`No. of Observations (Frequency)`[dept_men$`Nature of the Department` == "Others"]*0.01316, 2)

last_dept_men_full_plot <- c(mean_hard_men, mean_soft_men, mean_others_men)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_men_plot_dta <- data.frame(last_dept_men_full_plot, last_dept_agg_lable) 
last_dept_men_plot_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_men_full_plot <- ggplot(last_dept_men_plot_dta, aes(x=last_dept_agg_lable, y=last_dept_men_full_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_men_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent",  subtitle = "Last Departments: Male Officers (1951-2020)") +
  newtheme

last_dept_men_full_plot

legend2 <- cowplot::get_legend(last_dept_men_full_plot)
last_dept_men_full_plot <- last_dept_men_full_plot +theme(legend.position = "none")
last_dept_gender <- plot_grid(last_dept_men_full_plot, last_dept_women_full_plot, nrow=1)
last_dept_gender
```

III. Last Departments: Dis-aggregated by Source of Recruitment

```{r, echo = FALSE, fig.height=5,fig.width=8, warning=FALSE}
#Direct Recruitees
mean_hard_DR <- round(dept_DR$`No. of Observations (Frequency)`[dept_DR$`Nature of the Department` == "Hard"]*0.01991, 2)
mean_soft_DR <- round(dept_DR$`No. of Observations (Frequency)`[dept_DR$`Nature of the Department` == "Soft"]*0.01991, 2)
mean_others_DR <- round(dept_DR$`No. of Observations (Frequency)`[dept_DR$`Nature of the Department` == "Others"]*0.01991, 2)

last_dept_DR_full_plot <- c(mean_hard_DR, mean_soft_DR, mean_others_DR)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_DR_plot_dta <- data.frame(last_dept_DR_full_plot, last_dept_agg_lable) 
last_dept_DR_plot_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_DR_full_plot <- ggplot(last_dept_DR_plot_dta, aes(x=last_dept_agg_lable, y=last_dept_DR_full_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_DR_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", subtitle = "Last Departments: Direct Recruits (1951-2020)") +
  newtheme

last_dept_DR_full_plot

#Promotees
mean_hard_SCS <- round(dept_SCS$`No. of Observations (Frequency)`[dept_SCS$`Nature of the Department` == "Hard"]*0.0297, 2)
mean_soft_SCS <- round(dept_SCS$`No. of Observations (Frequency)`[dept_SCS$`Nature of the Department` == "Soft"]*0.0297, 2)
mean_others_SCS <- round(dept_SCS$`No. of Observations (Frequency)`[dept_SCS$`Nature of the Department` == "Others"]*0.0297, 2)

last_dept_SCS_full_plot <- c(mean_hard_SCS, mean_soft_SCS, mean_others_SCS)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_SCS_plot_dta <- data.frame(last_dept_SCS_full_plot, last_dept_agg_lable) 
last_dept_SCS_plot_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_SCS_full_plot <- ggplot(last_dept_SCS_plot_dta, aes(x=last_dept_agg_lable, y=last_dept_SCS_full_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_SCS_full_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent",  subtitle = "Last Departments: Promotees (1951-2020)") +
  newtheme

last_dept_SCS_full_plot

legend2 <- cowplot::get_legend(last_dept_DR_full_plot)
last_dept_DR_full_plot <- last_dept_DR_full_plot +theme(legend.position = "none")
last_dept_SOR <- plot_grid(last_dept_DR_full_plot, last_dept_SCS_full_plot, nrow=1)
last_dept_SOR
```

I. Aggregate graph: Last Positions (former officers)

```{r, echo = FALSE, fig.height=6,fig.width=8, warning=FALSE}
mean_ASL_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Above Secretary Level"]*0.0127, 2)
mean_AS_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Additional Secretary"]*0.0127, 2)
mean_CS_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Cabinet Secretary"]*0.0127, 2)
mean_DS_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Deputy Secretary"]*0.0127, 2)
mean_DR_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Director"]*0.0127, 2)
mean_JS_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Joint Secretary"]*0.0127, 2)
mean_jsc_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Junior Scale"]*0.0127, 2)
mean_S_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Secretary"]*0.0127, 2)
mean_US_former <- round(Last_Positions_former$`No. of Observations (Frequency)`[Last_Positions_former$`Last Positions` == "Under Secretary"]*0.0127, 2)

lp_full_former_plot <- c(mean_ASL_former, mean_AS_former, mean_CS_former, mean_DS_former, mean_DR_former, mean_JS_former, mean_jsc_former, mean_S_former, mean_US_former)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_plot_former_dta <- data.frame(lp_full_former_plot, last_position_agg_lable) 
lp_plot_former_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_plot_former_dta$last_position_agg_lable <- factor(lp_plot_former_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_full_former_plot <- ggplot(lp_plot_former_dta, aes(x=last_position_agg_lable, y=lp_full_former_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,30)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Aggregate graph: Last Positions of former officers (1951-2020)", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_full_former_plot
```

II. Last Positions: Dis-aggregated by Gender (former officers)

```{r, echo = FALSE, fig.height=8,fig.width=10, warning=FALSE}
#Women Officers
mean_ASL_women_former <- round(LP_women$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Above Secretary Level"]*0.19305, 2)
mean_AS_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Additional Secretary"]*0.19305, 2)
mean_CS_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Cabinet Secretary"]*0.19305, 2)
mean_DS_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Deputy Secretary"]*0.19305, 2)
mean_DR_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Director"]*0.19305, 2)
mean_JS_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Joint Secretary"]*0.19305, 2)
mean_jsc_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Junior Scale"]*0.19305, 2)
mean_S_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Secretary"]*0.19305, 2)
mean_US_women_former <- round(LP_women_former$`No. of Observations (Frequency)`[LP_women_former$`Last Positions` == "Under Secretary"]*0.19305, 2)

lp_women_full_former_plot <- c(mean_ASL_women_former, mean_AS_women_former, mean_CS_women_former, mean_DS_women_former, mean_DR_women_former, mean_JS_women_former, mean_jsc_women_former, mean_S_women_former, mean_US_women_former)

last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 

lp_women_plot_former_dta <- data.frame(lp_women_full_former_plot, last_position_agg_lable) 
lp_women_plot_former_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_women_plot_former_dta$last_position_agg_lable <- factor(lp_women_plot_former_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_women_full_former_plot <- ggplot(lp_women_plot_former_dta, aes(x=last_position_agg_lable, y=lp_women_full_former_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_women_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,50)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Women Officers (Former)") +
  newtheme

lp_women_full_former_plot

#Male Officers
mean_ASL_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Above Secretary Level"]*0.01359, 2)
mean_AS_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Additional Secretary"]*0.01359, 2)
mean_CS_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Cabinet Secretary"]*0.01359, 2)
mean_DS_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Deputy Secretary"]*0.01359, 2)
mean_DR_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Director"]*0.01359, 2)
mean_JS_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Joint Secretary"]*0.01359, 2)
mean_jsc_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Junior Scale"]*0.01359, 2)
mean_S_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Secretary"]*0.01359, 2)
mean_US_men_former <- round(LP_men_former$`No. of Observations (Frequency)`[LP_men_former$`Last Positions` == "Under Secretary"]*0.01359, 2)

lp_men_full_former_plot <- c(mean_ASL_men_former, mean_AS_men_former, mean_CS_men_former, mean_DS_men_former, mean_DR_men_former, mean_JS_men_former, mean_jsc_men_former, mean_S_men_former, mean_US_men_former)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_men_plot_former_dta <- data.frame(lp_men_full_former_plot, last_position_agg_lable) 
lp_men_plot_former_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_men_plot_former_dta$last_position_agg_lable <- factor(lp_men_plot_former_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_men_full_former_plot <- ggplot(lp_men_plot_former_dta, aes(x=last_position_agg_lable, y=lp_men_full_former_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_men_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,50)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Male Officers (Former)", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_men_full_former_plot

grid.newpage()
grid.draw(rbind(ggplotGrob(lp_women_full_former_plot), ggplotGrob(lp_men_full_former_plot), size = "last"))
```

III. Last Positions: Dis-aggregated by Source of Recruitment (former officers)

```{r, echo = FALSE, fig.height=8,fig.width=10, warning=FALSE}
#Direct Recruits
mean_ASL_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Above Secretary Level"]*0.02679, 2)
mean_AS_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Additional Secretary"]*0.02679, 2)
mean_CS_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Cabinet Secretary"]*0.02679, 2)
mean_DS_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Deputy Secretary"]*0.02679, 2)
mean_DR_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Director"]*0.02679, 2)
mean_JS_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Joint Secretary"]*0.02679, 2)
mean_jsc_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Junior Scale"]*0.02679, 2)
mean_S_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Secretary"]*0.02679, 2)
mean_US_DR_former <- round(LP_DR_former$`No. of Observations (Frequency)`[LP_DR_former$`Last Positions` == "Under Secretary"]*0.02679, 2)

lp_DR_full_former_plot <- c(mean_ASL_DR_former, mean_AS_DR_former, mean_CS_DR_former, mean_DS_DR_former, mean_DR_DR_former, mean_JS_DR_former, mean_jsc_DR_former, mean_S_DR_former, mean_US_DR_former)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_DR_plot_former_dta <- data.frame(lp_DR_full_former_plot, last_position_agg_lable) 
lp_DR_plot_former_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_DR_plot_former_dta$last_position_agg_lable <- factor(lp_DR_plot_former_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_DR_full_former_plot <- ggplot(lp_DR_plot_former_dta, aes(x=last_position_agg_lable, y=lp_DR_full_former_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_DR_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,60)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Former officers hired through Direct Recruitment (1951-2020)") +
  newtheme

lp_DR_full_former_plot

#SCS
mean_ASL_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Above Secretary Level"]*0.02494, 2)
mean_AS_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Additional Secretary"]*0.02494, 2)
mean_CS_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Cabinet Secretary"]*0.02494, 2)
mean_DS_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Deputy Secretary"]*0.02494, 2)
mean_DR_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Director"]*0.02494, 2)
mean_JS_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Joint Secretary"]*0.02494, 2)
mean_jsc_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Junior Scale"]*0.02494, 2)
mean_S_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Secretary"]*0.02494, 2)
mean_US_SCS_former <- round(LP_SCS_former$`No. of Observations (Frequency)`[LP_SCS_former$`Last Positions` == "Under Secretary"]*0.02494, 2)

lp_SCS_full_former_plot <- c(mean_ASL_SCS_former, mean_AS_SCS_former, mean_CS_SCS_former, mean_DS_SCS_former, mean_DR_SCS_former, mean_JS_SCS_former, mean_jsc_SCS_former, mean_S_SCS_former, mean_US_SCS_former)
last_position_agg_lable <- c("Above Secretary Level", "Additional Secretary" , "Cabinet Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Junior Scale", "Secretary", "Under Secretary") 
lp_SCS_plot_former_dta <- data.frame(lp_SCS_full_former_plot, last_position_agg_lable) 
lp_SCS_plot_former_dta$wrapped_labels = str_wrap(last_position_agg_lable, width = 50)
lp_SCS_plot_former_dta$last_position_agg_lable <- factor(lp_SCS_plot_former_dta$last_position_agg_lable,
                                             levels = c("Junior Scale", "Under Secretary", "Deputy Secretary", "Director", "Joint Secretary", "Additional Secretary", "Secretary", "Cabinet Secretary", "Above Secretary Level"))
lp_SCS_full_former_plot <- ggplot(lp_SCS_plot_former_dta, aes(x=last_position_agg_lable, y=lp_SCS_full_former_plot, fill = last_position_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", lp_SCS_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,60)) +
  scale_x_discrete(labels = function(last_position_agg_lable) str_wrap(last_position_agg_lable, width = 10)) +
  scale_fill_brewer(palette="YlGnBu") +
  labs(x="",y="Percent", subtitle = "Last Positions: Former officers hired through promotion from State Civil Service (1951-2020)", caption = "Derived from 'TCPD-Bureaucrats of India' dataset") +
  newtheme

lp_SCS_full_former_plot

grid.newpage()
grid.draw(rbind(ggplotGrob(lp_DR_full_former_plot), ggplotGrob(lp_SCS_full_former_plot), size = "last"))
```

I. Aggregate graph: Last Departments (former officers)

```{r, echo = FALSE, fig.height=4,fig.width=6, warning=FALSE}
mean_hard_former <- round(Last_Departments_former$`No. of Observations (Frequency)`[Last_Departments_former$`Nature of the Department` == "Hard"]*0.01576, 2)
mean_soft_former <- round(Last_Departments_former$`No. of Observations (Frequency)`[Last_Departments_former$`Nature of the Department` == "Soft"]*0.01576, 2)
mean_others_former <- round(Last_Departments_former$`No. of Observations (Frequency)`[Last_Departments_former$`Nature of the Department` == "Others"]*0.01576, 2)

last_dept_full_former_plot <- c(mean_hard_former, mean_soft_former, mean_others_former)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_plot_former_dta <- data.frame(last_dept_full_former_plot, last_dept_agg_lable) 
last_dept_plot_former_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_full_former_plot <- ggplot(last_dept_plot_former_dta, aes(x=last_dept_agg_lable, y=last_dept_full_former_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", caption = "Derived from the 'TCPD-Bureaucrats of India' dataset", subtitle = "Aggregate graph: Last Departments of former officers (1951-2020)") +
  newtheme

last_dept_full_former_plot
```

II. Last Departments: Dis-aggregated by Gender (former officers)

```{r, echo = FALSE, fig.height=5,fig.width=8, warning=FALSE}
#Women Officers
mean_hard_women_former <- round(dept_women_former$`No. of Observations (Frequency)`[dept_women_former$`Nature of the Department` == "Hard"]*0.23364, 2)
mean_soft_women_former <- round(dept_women_former$`No. of Observations (Frequency)`[dept_women_former$`Nature of the Department` == "Soft"]*0.23364, 2)
mean_others_women_former <- round(dept_women_former$`No. of Observations (Frequency)`[dept_women_former$`Nature of the Department` == "Others"]*0.23364, 2)

last_dept_women_full_former_plot <- c(mean_hard_women_former, mean_soft_women_former, mean_others_women_former)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_women_plot_former_dta <- data.frame(last_dept_women_full_former_plot, last_dept_agg_lable) 
last_dept_women_plot_former_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_women_full_former_plot <- ggplot(last_dept_women_plot_former_dta, aes(x=last_dept_agg_lable, y=last_dept_women_full_former_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_women_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", subtitle = "Last Departments: Women Officers (Former)") +
  newtheme

last_dept_women_full_former_plot

#Male Officers
mean_hard_men_former <- round(dept_men_former$`No. of Observations (Frequency)`[dept_men_former$`Nature of the Department` == "Hard"]*0.0169, 2)
mean_soft_men_former <- round(dept_men_former$`No. of Observations (Frequency)`[dept_men_former$`Nature of the Department` == "Soft"]*0.0169, 2)
mean_others_men_former <- round(dept_men_former$`No. of Observations (Frequency)`[dept_men_former$`Nature of the Department` == "Others"]*0.0169, 2)

last_dept_men_full_former_plot <- c(mean_hard_men_former, mean_soft_men_former, mean_others_men_former)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_men_plot_former_dta <- data.frame(last_dept_men_full_former_plot, last_dept_agg_lable) 
last_dept_men_plot_former_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_men_full_former_plot <- ggplot(last_dept_men_plot_former_dta, aes(x=last_dept_agg_lable, y=last_dept_men_full_former_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_men_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent",  subtitle = "Last Departments: Male Officers (Former)") +
  newtheme

last_dept_men_full_former_plot

legend2 <- cowplot::get_legend(last_dept_men_full_former_plot)
last_dept_men_full_former_plot <- last_dept_men_full_former_plot +theme(legend.position = "none")
last_dept_gender_former <- plot_grid(last_dept_men_full_former_plot, last_dept_women_full_former_plot, nrow=1)
last_dept_gender_former
```

II. Last Departments: Dis-aggregated by Source of Recruitment (former officers)

```{r, echo = FALSE, fig.height=5,fig.width=10, warning=FALSE}
#Direct Recruitees
mean_hard_DR_former <- round(dept_DR_former$`No. of Observations (Frequency)`[dept_DR_former$`Nature of the Department` == "Hard"]*0.03131, 2)
mean_soft_DR_former <- round(dept_DR_former$`No. of Observations (Frequency)`[dept_DR_former$`Nature of the Department` == "Soft"]*0.03131, 2)
mean_others_DR_former <- round(dept_DR_former$`No. of Observations (Frequency)`[dept_DR_former$`Nature of the Department` == "Others"]*0.03131, 2)

last_dept_DR_full_former_plot <- c(mean_hard_DR_former, mean_soft_DR_former, mean_others_DR_former)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_DR_plot_former_dta <- data.frame(last_dept_DR_full_former_plot, last_dept_agg_lable) 
last_dept_DR_plot_former_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_DR_full_former_plot <- ggplot(last_dept_DR_plot_former_dta, aes(x=last_dept_agg_lable, y=last_dept_DR_full_former_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_DR_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent", subtitle = "Last Departments: Direct Recruits (former)") +
  newtheme

last_dept_DR_full_former_plot

#Promotees
mean_hard_SCS_former <- round(dept_SCS_former$`No. of Observations (Frequency)`[dept_SCS_former$`Nature of the Department` == "Hard"]*0.03299, 2)
mean_soft_SCS_former <- round(dept_SCS_former$`No. of Observations (Frequency)`[dept_SCS_former$`Nature of the Department` == "Soft"]*0.03299, 2)
mean_others_SCS_former <- round(dept_SCS_former$`No. of Observations (Frequency)`[dept_SCS_former$`Nature of the Department` == "Others"]*0.03299, 2)

last_dept_SCS_full_former_plot <- c(mean_hard_SCS_former, mean_soft_SCS_former, mean_others_SCS_former)
last_dept_agg_lable <- c("Hard Departments", "Soft Departments", "Others")
last_dept_SCS_plot_former_dta <- data.frame(last_dept_SCS_full_former_plot, last_dept_agg_lable) 
last_dept_SCS_plot_former_dta$wrapped_labels = str_wrap(last_dept_agg_lable, width = 50)
last_dept_SCS_full_former_plot <- ggplot(last_dept_SCS_plot_former_dta, aes(x=last_dept_agg_lable, y=last_dept_SCS_full_former_plot, fill = last_dept_agg_lable)) +
  geom_bar(stat="identity", width= 0.5, show.legend = FALSE) + 
  geom_text(aes(label=paste0(sprintf("%0.2f", last_dept_SCS_full_former_plot),"%"), vjust=-0.3), size=3.5) +
  scale_y_continuous(limits = c(0,80)) +
  scale_x_discrete(labels = function(last_dept_agg_lable) str_wrap(last_dept_agg_lable, width = 10)) +
  scale_fill_brewer(palette="GnBu") +
  labs(x="",y="Percent",  subtitle = "Last Departments: Promotees (former)") +
  newtheme

last_dept_SCS_full_former_plot

legend2 <- cowplot::get_legend(last_dept_DR_full_former_plot)
last_dept_DR_full_former_plot <- last_dept_DR_full_former_plot +theme(legend.position = "none")
last_dept_SOR_former <- plot_grid(last_dept_DR_full_former_plot, last_dept_SCS_full_former_plot, nrow=1)
last_dept_SOR_former
```

```{r, echo = FALSE, fig.height=5,fig.width=8, warning=FALSE}
#Trend Analysis: Recruitment by DR vs Promotion from SCS

Allotment_Year_DR <- as.data.frame(table(ias_profile$Allotment_Year[ias_profile$Assigned_SOR == "Direct Recruitment"])) %>% 
rename ("Allotment Year" = Var1) %>% 
rename (Frequency = Freq) %>% 
mutate (Proportions = round(Frequency*0.012526,2))

Allotment_Year_SCS <- as.data.frame(table(ias_profile$Allotment_Year[ias_profile$Assigned_SOR == "By Promotion from State Civil Service"])) %>% 
rename ("Allotment Year" = Var1) %>% 
rename (Frequency = Freq) %>% 
mutate (Proportions = round(Frequency*0.01841,2))
  
Allotment_Year_SCS$`Allotment Year` = as.numeric(levels(Allotment_Year_SCS$`Allotment Year`))[Allotment_Year_SCS$`Allotment Year`]
Allotment_Year_DR$`Allotment Year` = as.numeric(levels(Allotment_Year_DR$`Allotment Year`))[Allotment_Year_DR$`Allotment Year`]

#Plotting absolute values (frequency)
plot_SOR <- ggplot() + geom_point(aes(y = Frequency , x = `Allotment Year`), data = Allotment_Year_DR, colour = "red", size = 0.5) + 
geom_point(aes(y = Frequency , x = `Allotment Year`), data = Allotment_Year_SCS, colour = "green", size = 0.5, show.legend = TRUE) + 
scale_y_continuous(limits = c(0,350)) +
labs( subtitle = "Trend Analysis: Recruitment by DR vs Promotion from SCS")  +
geom_smooth(data = Allotment_Year_DR, colour = "red", method = "loess", aes(x = `Allotment Year`, y =  Frequency)) +
geom_smooth(data = Allotment_Year_SCS, colour = "green", method = "loess", aes(x = `Allotment Year`, y =  Frequency)) +
newtheme 
plot_SOR

#Plotting proportions
plot_SOR_proportions <- ggplot() + geom_point(aes(y = Proportions , x = `Allotment Year`), data = Allotment_Year_DR, colour = "red", size = 0.5) + 
geom_point(aes(y = Proportions , x = `Allotment Year`), data = Allotment_Year_SCS, colour = "green", size = 0.5, show.legend = TRUE) + 
scale_y_continuous(limits = c(0,5)) +
labs( subtitle = "Trend Analysis: Recruitment by DR vs Promotion from SCS")  +
geom_smooth(data = Allotment_Year_DR, colour = "red", method = "loess", aes(x = `Allotment Year`, y =  Proportions)) +
geom_smooth(data = Allotment_Year_SCS, colour = "green", method = "loess", aes(x = `Allotment Year`, y =  Proportions)) +
newtheme 
plot_SOR_proportions
```

```{r, echo = FALSE, fig.height=4,fig.width=8, warning=FALSE}
#Age at the time of Allotment: Direct Recruits vs Promotees

subset_age_SCS <- ias_profile %>% 
filter (Assigned_SOR == "By Promotion from State Civil Service") %>% 
filter (Allotment_age > 10) 

subset_age_DR <- ias_profile %>% 
filter (Assigned_SOR == "Direct Recruitment") %>% 
filter (Allotment_age > 10 | Allotment_age < 40)

mean_SCS <- round(mean(subset_age_SCS$Allotment_age),2) #48.66
mean_DR <-  round(mean(subset_age_DR$Allotment_age),2) #27.04

#Yearly averages for Direct Recruits
Yearwise_average_DR <- as.data.frame(table(subset_age_DR$Allotment_Year)) %>% 
rename (Allotment_Year = Var1)

#Using nested-ifelse to calculate average age for each year (Direct Recruits)
Yearwise_average_DR <- Yearwise_average_DR %>% 
mutate (Averages = ifelse(Yearwise_average_DR$Allotment_Year == 1951, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1951]), 
ifelse(Yearwise_average_DR$Allotment_Year == 1952, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1952]),
ifelse(Yearwise_average_DR$Allotment_Year == 1953, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1953]),
ifelse(Yearwise_average_DR$Allotment_Year == 1954, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1954]),
ifelse(Yearwise_average_DR$Allotment_Year == 1955, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1955]),
ifelse(Yearwise_average_DR$Allotment_Year == 1956, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1956]),
ifelse(Yearwise_average_DR$Allotment_Year == 1957, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1957]),
ifelse(Yearwise_average_DR$Allotment_Year == 1958, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1958]),
ifelse(Yearwise_average_DR$Allotment_Year == 1959, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1959]),
ifelse(Yearwise_average_DR$Allotment_Year == 1960, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1960]),
ifelse(Yearwise_average_DR$Allotment_Year == 1961, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1961]),
ifelse(Yearwise_average_DR$Allotment_Year == 1962, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1962]),
ifelse(Yearwise_average_DR$Allotment_Year == 1963, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1963]),
ifelse(Yearwise_average_DR$Allotment_Year == 1964, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1964]),
ifelse(Yearwise_average_DR$Allotment_Year == 1965, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1965]),
ifelse(Yearwise_average_DR$Allotment_Year == 1966, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1966]),
ifelse(Yearwise_average_DR$Allotment_Year == 1967, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1967]),
ifelse(Yearwise_average_DR$Allotment_Year == 1968, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1968]),
ifelse(Yearwise_average_DR$Allotment_Year == 1969, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1969]),
ifelse(Yearwise_average_DR$Allotment_Year == 1970, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1970]),
ifelse(Yearwise_average_DR$Allotment_Year == 1971, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1971]),
ifelse(Yearwise_average_DR$Allotment_Year == 1972, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1972]),
ifelse(Yearwise_average_DR$Allotment_Year == 1973, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1973]),
ifelse(Yearwise_average_DR$Allotment_Year == 1974, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1974]),
ifelse(Yearwise_average_DR$Allotment_Year == 1975, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1975]),
ifelse(Yearwise_average_DR$Allotment_Year == 1976, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1976]),
ifelse(Yearwise_average_DR$Allotment_Year == 1977, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1977]),
ifelse(Yearwise_average_DR$Allotment_Year == 1978, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1978]),
ifelse(Yearwise_average_DR$Allotment_Year == 1979, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1979]),
ifelse(Yearwise_average_DR$Allotment_Year == 1980, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1980]),
ifelse(Yearwise_average_DR$Allotment_Year == 1981, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1981]),
ifelse(Yearwise_average_DR$Allotment_Year == 1982, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1982]),
ifelse(Yearwise_average_DR$Allotment_Year == 1983, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1983]),
ifelse(Yearwise_average_DR$Allotment_Year == 1984, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1984]),
ifelse(Yearwise_average_DR$Allotment_Year == 1985, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1985]),
ifelse(Yearwise_average_DR$Allotment_Year == 1986, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1986]),
ifelse(Yearwise_average_DR$Allotment_Year == 1987, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1987]),
ifelse(Yearwise_average_DR$Allotment_Year == 1988, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1988]),
ifelse(Yearwise_average_DR$Allotment_Year == 1989, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1989]),
ifelse(Yearwise_average_DR$Allotment_Year == 1990, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1990]), 0)))))))))))))))))))))))))))))))))))))))))

Yearwise_average_DR <- Yearwise_average_DR %>% 
mutate (Averages = ifelse(Yearwise_average_DR$Allotment_Year == 1991, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1991]),
ifelse(Yearwise_average_DR$Allotment_Year == 1992, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1992]),
ifelse(Yearwise_average_DR$Allotment_Year == 1993, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1993]),
ifelse(Yearwise_average_DR$Allotment_Year == 1994, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1994]),
ifelse(Yearwise_average_DR$Allotment_Year == 1995, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1995]),
ifelse(Yearwise_average_DR$Allotment_Year == 1996, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1996]),
ifelse(Yearwise_average_DR$Allotment_Year == 1997, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1997]),
ifelse(Yearwise_average_DR$Allotment_Year == 1998, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1998]),
ifelse(Yearwise_average_DR$Allotment_Year == 1999, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 1999]),
ifelse(Yearwise_average_DR$Allotment_Year == 2000, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2000]),
ifelse(Yearwise_average_DR$Allotment_Year == 2001, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2001]),
ifelse(Yearwise_average_DR$Allotment_Year == 2002, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2002]),
ifelse(Yearwise_average_DR$Allotment_Year == 2003, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2003]),
ifelse(Yearwise_average_DR$Allotment_Year == 2004, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2004]),
ifelse(Yearwise_average_DR$Allotment_Year == 2005, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2005]),
ifelse(Yearwise_average_DR$Allotment_Year == 2006, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2006]), ifelse(Yearwise_average_DR$Allotment_Year == 2007, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2007]),
ifelse(Yearwise_average_DR$Allotment_Year == 2008, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2008]),
ifelse(Yearwise_average_DR$Allotment_Year == 2009, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2009]), ifelse(Yearwise_average_DR$Allotment_Year == 2010, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2010]),
ifelse(Yearwise_average_DR$Allotment_Year == 2011, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2011]), ifelse(Yearwise_average_DR$Allotment_Year == 2012, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2012]),
ifelse(Yearwise_average_DR$Allotment_Year == 2013, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2013]),
ifelse(Yearwise_average_DR$Allotment_Year == 2014, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2014]), ifelse(Yearwise_average_DR$Allotment_Year == 2015, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2015]), ifelse(Yearwise_average_DR$Allotment_Year == 2016, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2016]), ifelse(Yearwise_average_DR$Allotment_Year == 2017, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2017]), ifelse(Yearwise_average_DR$Allotment_Year == 2018, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2018]), ifelse(Yearwise_average_DR$Allotment_Year == 2019, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2019]), ifelse(Yearwise_average_DR$Allotment_Year == 2020, mean(subset_age_DR$Allotment_age[subset_age_DR$Allotment_Year == 2020]), Averages)))))))))))))))))))))))))))))))

#Using nested-ifelse to calculate average age for each year (Direct Recruits)
Yearwise_average_SCS <- as.data.frame(table(subset_age_SCS$Allotment_Year)) %>% 
rename (Allotment_Year = Var1)

Yearwise_average_SCS <- Yearwise_average_SCS %>% 
mutate (Averages = ifelse(Yearwise_average_SCS$Allotment_Year == 1951, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1951]), 
ifelse(Yearwise_average_SCS$Allotment_Year == 1952, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1952]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1953, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1953]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1954, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1954]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1955, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1955]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1956, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1956]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1957, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1957]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1958, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1958]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1959, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1959]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1960, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1960]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1961, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1961]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1962, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1962]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1963, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1963]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1964, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1964]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1965, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1965]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1966, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1966]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1967, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1967]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1968, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1968]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1969, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1969]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1970, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1970]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1971, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1971]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1972, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1972]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1973, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1973]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1974, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1974]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1975, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1975]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1976, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1976]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1977, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1977]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1978, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1978]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1979, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1979]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1980, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1980]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1981, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1981]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1982, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1982]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1983, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1983]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1984, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1984]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1985, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1985]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1986, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1986]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1987, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1987]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1988, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1988]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1989, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1989]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1990, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1990]), 0)))))))))))))))))))))))))))))))))))))))))

Yearwise_average_SCS <- Yearwise_average_SCS %>% 
mutate (Averages = ifelse(Yearwise_average_SCS$Allotment_Year == 1991, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1991]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1992, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1992]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1993, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1993]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1994, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1994]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1995, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1995]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1996, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1996]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1997, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1997]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1998, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1998]),
ifelse(Yearwise_average_SCS$Allotment_Year == 1999, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 1999]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2000, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2000]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2001, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2001]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2002, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2002]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2003, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2003]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2004, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2004]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2005, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2005]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2006, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2006]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2007, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2007]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2008, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2008]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2009, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2009]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2010, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2010]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2011, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2011]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2012, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2012]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2013, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2013]),
ifelse(Yearwise_average_SCS$Allotment_Year == 2014, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2014]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2015, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2015]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2016, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2016]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2017, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2017]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2018, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2018]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2019, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2019]),      ifelse(Yearwise_average_SCS$Allotment_Year == 2020, mean(subset_age_SCS$Allotment_age[subset_age_SCS$Allotment_Year == 2020]), Averages)))))))))))))))))))))))))))))))

Yearwise_average_DR$Allotment_Year = as.numeric(levels(Yearwise_average_DR$Allotment_Year))

Yearwise_average_SCS$Allotment_Year = as.numeric(levels(Yearwise_average_SCS$Allotment_Year))

plot_age_allotment <- ggplot() + geom_point(data = Yearwise_average_DR, aes(y = Averages, x = Allotment_Year, group = 1), colour = "red") + 
geom_point(data = Yearwise_average_SCS, aes(y = Averages, x = Allotment_Year, group = 1), colour = "green") +
scale_y_continuous(limits = c(20,65)) +
labs( subtitle = "Age at the time of Allotment: Direct Recruits and Promotees") +
geom_smooth(data = Yearwise_average_DR, colour = "red", method = "loess", aes(x = Allotment_Year, y =  Averages)) +
geom_smooth(data = Yearwise_average_SCS, colour = "green", method = "loess", aes(x = Allotment_Year, y =  Averages)) +
newtheme

plot_age_allotment
```

```{r}
ias_profile <- ias_profile %>% 
mutate ("No. of Officers" = 1)

SOR <- ias_profile %>% 
group_by(Allotment_Year, Assigned_SOR) %>%
summarise("Proportions (yearwise)" = sum(`No. of Officers`)) %>%
filter(!is.na(Assigned_SOR)) %>% 
rename ("Assigned SOR" = Assigned_SOR) %>% 
rename ("Allotment Year" = Allotment_Year) 

SOR$`Allotment Year` <- as.numeric(as.character(SOR$`Allotment Year`))

SOR_areaplot <- ggplot(SOR, (aes(x = `Allotment Year`,  y = `Proportions (yearwise)`, fill = `Assigned SOR`))) +
    geom_area(position = "fill") +
    scale_y_continuous(labels = scales::percent) +
  labs( subtitle = "Allotment by year and Source of Recruitment") +
  newtheme
SOR_areaplot
```

```{r}
prop_allotment_DR <- as.data.frame(table(ias_profile$Allotment_Decade[ias_profile$Assigned_SOR == "Direct Recruitment"])) %>% 
rename ("Interval" = Var1) %>% 
rename ("No. of officers (DR)" = Freq)

prop_allotment_SCS <- as.data.frame(table(ias_profile$Allotment_Decade[ias_profile$Assigned_SOR == "By Promotion from State Civil Service"])) %>% 
rename ("Interval1" = Var1) %>% 
rename ("No. of officers (Promotees)" = Freq)

prop_allotment <- cbind (prop_allotment_DR, prop_allotment_SCS) %>% 
dplyr:: select(-Interval1) %>% 
mutate("Total no. of Officers" = rowSums(.[2:3])) %>% 
mutate (prop_DR = `No. of officers (DR)`/`Total no. of Officers`) %>% 
mutate (prop_SCS = `No. of officers (Promotees)`/`Total no. of Officers`) %>% 
mutate (prop_DR= round(prop_DR*100,2)) %>% 
mutate (prop_SCS= round(prop_SCS*100,2)) %>% 
dplyr:: select (-`No. of officers (DR)`, -`No. of officers (Promotees)`)

prop_allotment %>%
  kbl(caption = "Distribution of all officers by Source of Recruitment and Allotment Year")%>%
  kable_classic(full_width = F, html_font = "Cambria", font_size = 15) %>% 
  footnote(number = c("Derived from the 'TCPD-Bureaucrats of India' Dataset", "Sample: Total no. of officers hired between 1951 and 2020"))
```

